<script>
  window.addEventListener("DOMContentLoaded", () => {
    const mcStatusEl = document.getElementById('mc-status');
    const eventStatusEl = document.getElementById('event-status');
    const webStatusEl = document.getElementById('web-status');
    const hostingStatusEl = document.getElementById('hosting-status');
    const countdownEl = document.getElementById('countdown');

    let mcOnline = false;
    let eventOnline = false;

    async function checkMC() {
      try {
        const res = await fetch('https://api.mcsrvstat.us/2/mc.3zscraft.cz');
        const data = await res.json();
        if (data.online) {
          mcOnline = true;
          mcStatusEl.textContent = 'Online';
          mcStatusEl.className = 'status';
        } else {
          mcOnline = false;
          mcStatusEl.textContent = 'Offline';
          mcStatusEl.className = 'status offline';
        }
      } catch {
        mcOnline = false;
        mcStatusEl.textContent = 'Chyba při načítání';
        mcStatusEl.className = 'status offline';
      }
    }

    async function checkEvent() {
      try {
        const res = await fetch('https://api.mcsrvstat.us/2/event.3zscraft.cz');
        const data = await res.json();
        if (data.online) {
          eventOnline = true;
          eventStatusEl.textContent = 'Online';
          eventStatusEl.className = 'status';
        } else {
          eventOnline = false;
          eventStatusEl.textContent = 'Offline';
          eventStatusEl.className = 'status offline';
        }
      } catch {
        eventOnline = false;
        eventStatusEl.textContent = 'Chyba při načítání';
        eventStatusEl.className = 'status offline';
      }
    }

    async function checkWeb() {
      try {
        const res = await fetch('https://www.3zscraft.cz', { method: 'HEAD' });
        if (res.ok) {
          webStatusEl.textContent = 'Online';
          webStatusEl.className = 'status';
        } else {
          throw new Error('Offline');
        }
      } catch {
        webStatusEl.textContent = 'Offline';
        webStatusEl.className = 'status offline';
      }
    }

    async function checkAll() {
      mcStatusEl.textContent = 'Načítám...';
      eventStatusEl.textContent = 'Načítám...';
      webStatusEl.textContent = 'Načítám...';
      hostingStatusEl.textContent = '';

      if (!navigator.onLine) {
        mcStatusEl.textContent = 'Offline (bez připojení)';
        eventStatusEl.textContent = 'Offline (bez připojení)';
        webStatusEl.textContent = 'Offline (bez připojení)';
        mcStatusEl.className = eventStatusEl.className = webStatusEl.className = 'status offline';
        hostingStatusEl.textContent = 'Není připojeno k internetu';
        return;
      }

      await Promise.all([checkMC(), checkEvent(), checkWeb()]);

      if (!mcOnline && !eventOnline) {
        hostingStatusEl.textContent = 'Náš hosting je vypnutý.';
      }
    }

    function startCountdown() {
      let time = 30;
      countdownEl.textContent = time;
      const interval = setInterval(() => {
        time--;
        countdownEl.textContent = time;
        if (time <= 0) {
          clearInterval(interval);
          checkAll();
          startCountdown(); // restartujeme nový odpočet
        }
      }, 1000);
    }

    checkAll();
    startCountdown();
  });
</script>
